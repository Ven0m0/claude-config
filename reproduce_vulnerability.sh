#!/bin/bash
# Malicious JSON: "comment" contains a fake command key-value pair that looks safe,
# while the real "command" tries to access a restricted directory (node_modules).
json='{
  "comment": "This looks like a \"command\": \"echo safe\"",
  "command": "cat node_modules/package.json"
}'

echo "Testing with malicious JSON:"
echo "$json"
echo ""

# Run the validation script
./plugins/dependency-blocker/scripts/bash-validate.sh <<< "$json"
exit_code=$?

if [ $exit_code -eq 0 ]; then
  echo "VULNERABILITY CONFIRMED: Script exited with 0 (allowed). The real command (cat node_modules/...) should have been blocked."
else
  echo "Script exited with $exit_code (blocked). The vulnerability might not be reproducible this way."
fi
