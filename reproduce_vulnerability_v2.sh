#!/bin/bash
# Malicious JSON: "fake_command" key ends with "command", confusing the naive parser.
json='{
  "fake_command": "echo safe",
  "command": "cat node_modules/package.json"
}'

echo "Testing with malicious JSON v2:"
echo "$json"
echo ""

# Run the validation script
./plugins/dependency-blocker/scripts/bash-validate.sh <<< "$json"
exit_code=$?

if [ $exit_code -eq 0 ]; then
  echo "VULNERABILITY CONFIRMED: Script exited with 0 (allowed). The real command (cat node_modules/...) was ignored."
else
  echo "Script exited with $exit_code (blocked)."
fi
